<FULL CODE FROM EARLIER MESSAGE HERE>